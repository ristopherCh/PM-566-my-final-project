---
title: "PM566 Final Project Supplementary"
author: "Chris Hanson"
output: 
    html_document:
        toc: TRUE
        toc_float: TRUE
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  warning = FALSE,
  message = FALSE,
  fig.align = 'center',
  fig.width = 10
  )
```

```{r covid_usa_plot}
gct <- ggplot(covid_usa, aes(x = date, y = new_case)) +
  geom_line() +
  labs(title = "New US COVID-19 cases", subtitle = "Source: data.cdc.gov API") +
  geom_vline(xintercept=as.numeric(covid_usa$date[52]), linetype="dashed", size = 1) +
  annotate(geom = "text", x = covid_usa$date[60], y = 150000, label = "Emergency Declaration", angle = 90, color = "blue") +
  geom_vline(xintercept=as.numeric(covid_usa$date[109]), linetype="dashed", size = 1) +
  annotate(geom = "text", x = covid_usa$date[117], y = 150000, label = "14.7% unemployment", angle = 90, color = "blue") +
  geom_vline(xintercept=as.numeric(covid_usa$date[416]), linetype="dashed", size = 1) +
  annotate(geom = "text", x = covid_usa$date[424], y = 150000, label = "100 million vaccinations", angle = 90, color = "blue")+
  geom_vline(xintercept=as.numeric(covid_usa$date[329]), linetype="dashed", size = 1) +
  annotate(geom = "text", x = covid_usa$date[337], y = 60000, label = "Vaccination begins", angle = 90, color = "blue") +
  geom_vline(xintercept=as.numeric(covid_usa$date[527]), linetype="dashed", size = 1) +
  annotate(geom = "text", x = covid_usa$date[535], y = 150000, label = "Delta variant spreads", angle = 90, color = "blue") +
  xlab("Date") + ylab("New COVID-19 cases")

gct
```

#### COVID-19 cases per state

```{r}
ggplotly(ccpp)
```

#### COVID-19 deaths per state

```{r}
ggplotly(cdpp)
```

```{r plot_covidvsod2}
ggplotly(od_cov2)
```

```{r maps}
g <- list(
  scope = 'usa',
  projection = list(type = 'albers usa'),
  lakecolor = toRGB('white')
)
```

```{r map_covid}
# Covid death as a percentage of state population, most recent available data
plot_geo() %>%
  add_trace(
    z = ~covid_od$death_perc, text = covid_od$state_name, span = I(0),
    locations = covid_od$state, locationmode = 'USA-states'
  ) %>%
  layout(geo = g) %>%
  colorbar(title = "COVID-19 \nassociated deaths \n(% of pop)\nthrough April 2021")
```

```{r map_ods}
# OD deaths as a percentage of state population since COVID began
plot_geo() %>%
  add_trace(
    z = ~covid_od$odincrease_apr20apr21, text = covid_od$state_name, span = I(0),
    locations = covid_od$state, locationmode = 'USA-states'
  ) %>%
  layout(geo = g) %>%
  colorbar(title = "% increase in\nOD associated \ndeaths,\n2019 to 2020")
```

```{r}
ggplotly(unem)
```

### Unemployment vs deaths by OD {.tabset}

#### Tab 1

```{r plot_umpod1}
ggplotly(u5, tooltip = c("label")) 
```

#### Tab 2

```{r plot_umpod3}
ggplotly(u3, tooltip = c("label"))
```

### {-}

**Tab 1** shows raw unemployment numbers compared to raw deaths due to overdose per state, without considering prior unemployment values. Even without the influence of COVID-19, a relationship between these variables is to be expected, and indeed a positive relationship appears to exist.

**Tab 2** shows the same data, but with unemployment normalized against pre COVID-19 levels. The relationship still appears positively correlated, but with greater variance.

### Economic slowdown due to COVID-19 {.tabset}

#### Tab 1

```{r plot_econ1}
ggplotly(ggecon)
```

#### Tab 2

```{r plot_econ2}
ggplotly(ggecon_rel)
```
### {-}
